<!DOCTYPE html>
<html lang="en">

  <%- include('partials/head') %>
  <!-- Load js dependencies -->
  <%- include('partials/bs_scripts') %>
<script>
// get ready
$(function(){
  var btnDeviceOn = "border-success";
  var btnDeviceOff = "border-danger"
  var onoffDeviceOn = "text-success";
  var onoffDeviceOff = "text-danger"

  function turnOff(currID, currOnoff){
    $(currID).removeClass(btnDeviceOn).addClass(btnDeviceOff);
    $(currID + " i").removeClass(onoffDeviceOn).addClass(onoffDeviceOff);
    $(currOnoff).html("OFF").removeClass(onoffDeviceOn).addClass(onoffDeviceOff);
    $(currID).attr("data-pinstate", "false");
  };

  function turnOn(currID, currOnoff){
    $(currID).removeClass(btnDeviceOff).addClass(btnDeviceOn);
    $(currID + " i").removeClass(onoffDeviceOff).addClass(onoffDeviceOn);
    $(currOnoff).html("ON").removeClass(onoffDeviceOff).addClass(onoffDeviceOn);
    $(currID).attr("data-pinstate", "true");
  }

  //post on click
  $( "Button" ).on("click", function(){

     var currID = "#" + $(this).attr("ID");
     var currOnoff = "#onoff" + $(this).data("pin")
      var state =  $(currID).attr("data-pinstate");
     console.log(state);

     var url = './gpio/' + $(this).data('pin') + '/' + $(this).data('type') + '/toggle';
      $.post(url, function(){
            if(state == "false"){turnOn(currID, currOnoff);}
            else{turnOff(currID, currOnoff);}
          })
        .fail(function(){
          console.log("POST action failed");
        })
        .done(function(){
          // Change button state

        })

  })
})

var socket = io(); //load socket.io-client and connect to the host that serves the page

</script>

<script>
window.addEventListener("load", function(){ //when page loads
  var lightbox = document.getElementById("light");
  lightbox.addEventListener("click", function() { //add event listener for when checkbox changes
    socket.emit("light", number(this.checked)); //send button status to server (as 1 or 0)
  });
});
socket.on('light', function (data) { //get button status from client
  document.getElementById("light").checked = data; //change checkbox according to push button on Raspberry Pi
  socket.emit("light", data); //send push button status to back to server
});
</script>




  <body id="<%= pageID %>">
    <!-- include the navigation bar -->
    <%- include('partials/nav') %>


    <!-- Page content -->
    <div class="container mainBody" style="max-width: 80%;">
      <div class="row">
        <%- //include('cards/currentweather') %>

          <% devicestats.forEach(function(item){ %>

            <%- include('cards/device', {item: item}) %>
          <% }); %>
          <% function isEven(value) {return (value%2 == 0);}
          if(devicestats.length != 0){%>
            <div class="col-6 col-sm-4 col-md-3 mx-auto "></div>
          <% } %>

      </div>
    </div>



  </body>
</html>
